<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" href="chatstyle.css"/>
<script src="socket.io.js"></script>
<script src="jquery-1.10.2.js"></script>
</head>
<body>
<div class="main">
    <div class="main_inner">
        <div class="panel">
            <div class="header">
                <div class="avatar">
                    <img class="img" src="webwxgeticon.jpg" />
                </div>
                <div class="info">
                    <h3 class="nickname">
                        <span class="display_name">calvinzhang</span>
                        <a class="opt" href="javascript:;" ><i class="web_wechat_add"></i></a>
                    </h3>
                </div>
            </div>

            <div class="search_bar" id="search_bar">
                <i class="web_wechat_search"></i>
                <input class="frm_search" type="text" placeholder='search' />
            </div>

            <div class="tab" >
                <div class="tab_item">
                    <a class="chat" ui-sref="chat" title='聊天'><i class="web_wechat_tab_chat" ></i></a>
                </div>
                <div class="tab_item" >
                    <a class="chat" ui-sref="read" title='阅读'><i class="web_wechat_tab_public" ></i></a>
                </div>
                <div class="tab_item no_extra">
                    <a class="chat" ui-sref="contact" title='通讯录'><i class="web_wechat_tab_friends" ></i></a>
                </div>
            </div>

            <div ui-view="navView" id="navView"></div>

            <div class="nav_view"  nav-chat-directive >
                <div class="chat_item slide-left ng-scope top active" data-username="@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7" ng-click="itemClick(chatContact.UserName)"  data-cm="{&quot;type&quot;:&quot;chat&quot;,&quot;username&quot;:&quot;@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7&quot;}">
                    <div class="ext">
                        <p class="attr ng-binding">18:29</p>
                    </div>

                    <div class="avatar">
                        <img class="img" src="webwxgeticon.jpg" alt="">
                    </div>
                    <div class="info">
                        <h3 class="nickname">
                            <span class="nickname_text ng-binding">littl pig</span>
                        </h3>
                        <p class="msg ng-scope" >
                        <span class="ng-binding">i will go home soon</span>
                    </p>
                    </div>
                </div>
                <div class="chat_item slide-left ng-scope top active" data-username="@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7" ng-click="itemClick(chatContact.UserName)"  data-cm="{&quot;type&quot;:&quot;chat&quot;,&quot;username&quot;:&quot;@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7&quot;}">
                    <div class="ext">
                        <p class="attr ng-binding">18:29</p>
                    </div>

                    <div class="avatar">
                        <img class="img" src="webwxgeticon.jpg" alt="">
                    </div>
                    <div class="info">
                        <h3 class="nickname">
                            <span class="nickname_text ng-binding">littl pig</span>
                        </h3>
                        <p class="msg ng-scope" >
                            <span class="ng-binding">i will go home soon</span>
                        </p>
                    </div>
                </div>
                <div class="chat_item slide-left ng-scope top active" data-username="@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7" ng-click="itemClick(chatContact.UserName)"  data-cm="{&quot;type&quot;:&quot;chat&quot;,&quot;username&quot;:&quot;@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7&quot;}">
                    <div class="ext">
                        <p class="attr ng-binding">18:29</p>
                    </div>

                    <div class="avatar">
                        <img class="img" src="webwxgeticon.jpg" alt="">
                    </div>
                    <div class="info">
                        <h3 class="nickname">
                            <span class="nickname_text ng-binding">littl pig</span>
                        </h3>
                        <p class="msg ng-scope" >
                            <span class="ng-binding">i will go home soon</span>
                        </p>
                    </div>
                </div>
                <div class="chat_item slide-left ng-scope top active" data-username="@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7" ng-click="itemClick(chatContact.UserName)"  data-cm="{&quot;type&quot;:&quot;chat&quot;,&quot;username&quot;:&quot;@500fb398fb5ad1f6088f2a3854167307de94254608e6812f3ba6f8ec6582b7a7&quot;}">
                    <div class="ext">
                        <p class="attr ng-binding">18:29</p>
                    </div>

                    <div class="avatar">
                        <img class="img" src="webwxgeticon.jpg" alt="">
                    </div>
                    <div class="info">
                        <h3 class="nickname">
                            <span class="nickname_text ng-binding">littl pig</span>
                        </h3>
                        <p class="msg ng-scope" >
                            <span class="ng-binding">i will go home soon</span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="nav_view"  nav-contact-directive ></div>
            <div class="nav_view"  nav-read-directive ></div>
        </div>

        <div ui-view="contentView" style="height:100%;">
            <div id="chatArea" class="box chat ng-scope">
                <div class="box_hd">
                    <div id="chatRoomMembersWrap"></div>
                    <div class="title_wrap">
                        <div class="title poi">
                            <a class="title_name ng-binding"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">little pig</font></font></a>
                            <i class="web_wechat_down_icon"></i>
                        </div>
                    </div>
                </div>
                <div class="scroll-wrapper box_bd chat_bd scrollbar-dynamic" style="position: absolute;">
                    <div jquery-scrollbar="" class="box_bd chat_bd scrollbar-dynamic scroll-content" style="margin-bottom: 0px; margin-right: 0px; height: 528px;">
                        <div data-height-calc="heightCalc" data-buffer-height="300" data-pre-calc="true" class="ng-scope">
                            <div class="top-placeholder ng-scope" style="height: 0px;">

                            </div>
                            <!--聊天气泡 begin-->
                            <div class="ng-scope">
                                <div class="clearfix">
                                    <div  style="overflow: hidden;" >
                                        <div class="message ng-scope you">
                                            <div  class="message_system ng-scope">
                                                <div class="content ng-binding ng-scope">
                                                    <font style="vertical-align: inherit;">
                                                        <font style="vertical-align: inherit;">18:28</font>
                                                    </font>
                                                </div>
                                            </div>
                                            <img class="avatar" src="webwxgeticon.jpg">
                                            <div class="content">
                                                <div class="bubble js_message_bubble ng-scope bubble_default left">
                                                    <div class="bubble_cont ng-scope">
                                                        <div class="plain">
                                                            <pre class="js_message_plain ng-binding" ng-bind-html="message.MMActualContent"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test3</font></font></pre>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--聊天气泡 end-->
                            <!--聊天气泡 begin-->
                            <div class="ng-scope">
                                <div class="clearfix">
                                    <div  style="overflow: hidden;" >
                                        <div class="message ng-scope me">
                                            <div  class="message_system ng-scope">
                                                <div class="content ng-binding ng-scope">
                                                    <font style="vertical-align: inherit;">
                                                        <font style="vertical-align: inherit;">18:28</font>
                                                    </font>
                                                </div>
                                            </div>
                                            <img class="avatar" src="webwxgeticon.jpg">
                                            <div class="content">
                                                <div class="bubble js_message_bubble ng-scope bubble_default right">
                                                    <div class="bubble_cont ng-scope">
                                                        <div class="plain">
                                                            <pre class="js_message_plain ng-binding" ng-bind-html="message.MMActualContent"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test3</font></font></pre>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--聊天气泡 end-->

                            <div class="bottom-placeholder ng-scope" style="height: 0px;">

                            </div>
                        </div>
                        <div id="prerender" style="
                          visibility: hidden;
                          position: absolute;
                          width: 100%;
                          top: 333px;
                          height: 0;
                          padding: 0 19px;
                          box-sizing: border-box;
                          margin-left: -19px;
                          overflow: hidden;">
                        </div>
                    </div>
                </div>
                <div class="box_ft ng-scope">
                    <div class="toolbar" id="tool_bar">
                        <a class="web_wechat_face" href="javascript:;" title="表情"></a>
                        <a class="web_wechat_screencut ng-isolate-scope" href="javascript:;" title="截屏"></a>
                        <a class="web_wechat_pic js_fileupload ng-isolate-scope webuploader-container" href="javascript:;" title="图片和文件">
                            <div class="webuploader-pick">
                            </div>
                            <div id="rt_rt_1cdrue05g171j9tl1akn1piop751" style="position: absolute; top: 0px; left: 0px; width: 30px; height: 30px; overflow: hidden; bottom: auto; right: auto;">
                                <input type="file" name="file" class="webuploader-element-invisible" multiple="multiple">
                                <label style="opacity: 0; width: 100%; height: 100%; display: block; cursor: pointer; background: rgb(255, 255, 255);"></label>
                            </div>
                        </a>
                    </div>
                    <div class="content ng-isolate-scope">
                        <pre id="editArea" class="flex edit_area ng-isolate-scope ng-valid ng-dirty" contenteditable="true"></pre>
                        <span class="caret_pos_helper" id="caretPosHelper"></span>
                    </div>
                    <div class="action">
                        <span class="desc ng-scope"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl+Enter</font></font></span>
                        <a id="sendMessage" class="btn btn_send" href="javascript:;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Send</font></font></a>
                    </div>
                </div>
                <div id="J_CatchDrop" class="catch-drop-area">
                </div>
            </div>
        </div>

        <!--<div context-menu-directive>-->

        <!--</div>-->
    </div>
</div>
<div style="position:absolute;top:0;left:0;width:0;height:0;">
    <audio id="voiceMsgPlayer" class="voicePlayer"></audio>
    <audio id="msgNoticePlayer" class="voicePlayer"></audio>
</div>
<script>

    $(document).keydown(function(e){
        if(e.keyCode == 13) {
            $('#sendMessage').click();
        }
    });

    $(function () {

        var currentUserId=$("#username").text();
        var targetUserId;

        //初始化当前用户的socket
        var socket =  io.connect('http://localhost:8889?userid='+currentUserId);
        socket.on('connect', function() {

        });
        socket.on('messageevent', function(data) {
            $(".chat-thread").append("<li class='otherchatitem'>"+data.msgcontent+"</li>")
        });
        socket.on('disconnect', function() {

        });

        $("#sendMessage").click(function () {
            var message = $('#editArea').val();
            $('#editArea').val('');

            var jsonObject = {
                sourceclientid: clientid,
                targetclientid: targetClientId,
                msgtype: 'chat',
                msgcontent: message
            };
            $(".chat-thread").append("<li class='chatitem'>"+message+"</li>");
            currentSocket.emit('messageevent', jsonObject);
        });

    });
</script>
</body>

</html>